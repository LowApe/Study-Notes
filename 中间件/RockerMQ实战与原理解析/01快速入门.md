# 快速入门

- 了解 RocketMQ
- 分布式消息队列的功能
- 搭建单机版的消息队列

# 消息队列功能介绍

> 分布式消息队列可以提供**应用解耦、流量消峰、消息分发等功能**

## 应用解耦

> 以电商应用为例，用户创建订单后，如果耦合调用库存系统、物流系统、支付系统，任何一个子系统出了故障或者升级等原因不可用。都会造成下单操作异常，影响用户体验。
>
> 如果转变成基于消息队列的方式后，系统可用性就高多了，比如物流系统因为发生故障，需要几分钟的时间来修复，在这几分钟的时间里，用户的下单操作可以正常完成。当**物流恢复后，补充处理存储在消息队列里的订单信息即可**

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1gijboh4f0mj30xo0byad4.jpg)

## 流量消峰

> 电商系统，在活动期间流量瞬间猛增，需要有**缓存机制**，让系统承受住大流量的冲击。通过利用消息队列，把**大量的请求暂存起来**，分散到相对长的一段时间（流量退潮后处理），能大大提高系统的可用性和用户体验。
>
> 举个例子：如果订单系统每秒最多处理一万次下单，这个处理能力应对正常时段的下单时绰绰有余呢，正常时段我们下单后一秒内就能返回结果。在双十一，如果没有**缓存机制**，订单超过一万次就不允许用户下单了(防止系统宕机)，**如果有消息队列做缓冲，就把一秒内的订单分散成一段时间处理，这时有些用户可能在下单后几十秒才能收到下单成功的状态，但是也比不能下单的体验要好。**

使用消息队列进行流量消峰，很多时候不是因为能力不够，而是处于经济性的考量。比如有的业务系统，流量最高峰也不会超过一万 QPS，而平时只有一千左右的 QPS。 这种情况下我们就可以用个普通性能分服务器(只支持一千QPS)，然后加个消息队列进行高峰期的缓冲，而不是每台机器都是一万QPS性能，降低部署服务器资金。

## 消息分发

> 大数据时代，数据对公司非常重要，公司需要依赖对数据分析等各种操作，**各个分析团队、算法团队都要依赖这些数据进行工作**，这时候可持久化的消息队列就非常重要。数据的产生方只需要把**各自的数据写入一个消息队列**即可，各自使用方根据各自需求**订阅感兴趣的数据**，不同数据团队所订阅的数据可以重复也可以不重复，互不干扰，也不必和数据产生方关联。

![image.png](http://ww1.sinaimg.cn/mw690/006rAlqhgy1gijcntl9r5j30ym0laage.jpg)

上图显示各个子系统将日志数据写入消息队列，**不同的数据处理系统有各自的 Offset**，互不影响

**概念说明**

- QPS:每秒查询率
- TPS:每秒事务数
- IM:即时通信(Instant Messaging)是指能够即时发送和接收互联网消息等的业务。

## 一致性、方便动态扩展

> 内容待定



# RocketMQ简介

- 第一代 推模式，解决事务消息
- 第二代 拉模式,解决顺序消息和海量堆积问题
- RocketMQ 基于长轮训的拉取方式，兼有两者的优点

> RocketMQ是使用 Java 语言开发，比起 Kafka 的 Scala 语言和 RabbitMQ 的 Erlang 语言，更容易找到技术人员进行定制开发(Java毕竟主流开发语言)

## RocketMQ 各部分角色介绍

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1gc5i1cr4boj314e0hojvt.jpg)

RokcetMQ 由四部分组成

- Producer
- Consumer
- Broker
- NameServer

> 启动 RocketMQ 的顺序是先启动 NameServer，再启动 Broker，这时候消息队列可以提供服务了，发送消息使用 Producer 来发送，想接受消息就是用 Consumer 来接受。
>
> 这四种角色以后，再介绍一下 **Topic** 和 **Message Queue **。一个分布式消息队列中间件部署好以后，可以给很多业务提供服务，同一个业务也有不同类型的消息要投递，这些**不同类型的消息以不同的 Topic 名称来区分**。有了 Topic 以后，**还需要解决性能问题**。如果一个 Topic 要发送和接受的数据量非常大，需要能支持增加并行处理的机器来提高速度，这时候**一个Topic根据需求设置一个或多个 Message Queue，Message Queue 类似分区或 Partition**。Topic 有了 message Queue 之后，消息可以**并行地向各个 Message Queue 发送**，消费者也可以从多个 Message Queue 读取消息并消费

:helicopter:待补充一个理解图

# 快速上手 RokcetMQ

安装单机版 RocketMQ，详情参考(RokcetMQ搭建)

# 相关链接

- [GitHub 开源](https://github.com/apache/rocketmq/tree/master/docs/cn)
- [TPS、QPS和系统吞吐量的区别和理解](https://blog.csdn.net/u010889616/article/details/83245695)
- [Web 通信 之 长连接、长轮询(long polling)](https://www.cnblogs.com/hoojo/p/longpolling_comet_jquery_iframe_ajax.html)

