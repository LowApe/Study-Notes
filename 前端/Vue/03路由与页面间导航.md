# 目录

项目问题
1. 项目中应该有多少个页面?
2. 页面与页面之间存在何种关系,应该如何进行导航?
3. 哪里是程序入口?应该从哪个页面开始入手?

**思维导图**

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g31ynwo8eaj30xv0dsq6n.jpg)
微信网上书店的思维导图
![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g31yp7ew37j31250aqtbt.jpg)

**设计原型**

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g31yqlyfx0j30u20mhn2s.jpg)

# vue-router

路由是定义一系列的访问地址规则,路由引擎根据这些规则匹配并找到对应的处理页面,然后将请求转发给页进行处理。所有的后端开发都设这样的

前端路由是直接查找与地址匹配的一个组件或对象并将其渲染出来。

改变游览器地址而不向后端服务器发出请求的两种做法,
1. 在地址中加入 `#`,地址的改变是由于正在进行页内导航；
2. 使用 HTML5 的 window.history 功能,使用 URL 的 Hash 来模拟一个完整的 URL

**Vue.js官方提供了一套专用的路由工具库`vue-router`.`vue-router`的使用和配置都非常简单，而且代码清晰易读，很容易上手。
**

**将单页程序分割为各自功能合理的组件或者页面,路由起到了一个非常重要作用。**
路由连接页面程序中各页面之间的链条

## 安装

```shell
npm i vue-router -D
```

vue-router 实例是一个 Vue 的插件,我们需要在 Vue 的全局引用中通过 `Vue.use()` 将它接入到 Vue 实例中。我们工程中 `main.js` 程序入口,所有的全局性配置都会在这个文件中进行,打开 `main.js`

```js
import Vue from 'vue'
import Router from 'vue-router'
Vue.use(Router)
```
这样完成了 vue-router 最基本安装工作

## 路由配置
 单页式应用是没有 "页" 的概念的,更准确地说,Vue.js 的容器就只有组件。但我们用 `vue-router` 配合组件重新形成各种的"页"

 - 页面是一个抽象的逻辑概念,用于划分功能场景
 - 组件是页面在 Vue 的具体实现方式

 ![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g321a3nw2dj30n30hnado.jpg)

页面就是组件,那么一个路由定义就该与一个组件相对应,具体应该如下表所示。

 ![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g321aeshslj30pp06zglx.jpg)

> `*.vue` 文件是 Vue 的单页式组件文件格式,它可以同时包括模板定义、样式定义和组件模板模块定义。

首先,我们在项目目录下创建四个顶层页面的Vue组件文件:

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g321hp7e8mj306t061q2w.jpg)

每个页面组件内容暂时同样的结构:

```html
<template>

</template>

<script>
export default {

}
</script>

<style>

</style>

```

接下来就是在 main.js 文件中定义 **路由与这些组件的匹配规则** VueRouter 的定义非常简单易懂,只需要创建一个 VueRouter 实例,将路由 path 指定到一个组件类型上就可以

```js
import Vue from 'vue'
import App from './App'
import VueRouter from 'vue-router'
import Home from './Home.vue'
Vue.use(VueRouter)

const router = new VueRouter({
  mode: 'history',
  base: __dirname,
  routes: [
    {path: '/home',component:Home},
    {path: '/explorer',component:Explorer},
    {path: '/cart',component:Cart},
    {path: '/me',component:Me},
  ]
})

Vue.config.productionTip = false

/* eslint-disable no-new */
new Vue({
  el: '#app',
  router,
  render: h => h(App)
})
```

在真实的项目开发中,由于我们可能需要引入很多不同的第三方库,如上述代码所示,每一个库基本上都需要进行一些基本的配置,很明显这些配置会根据实际开发的需要不断地增加内容,如果都放在 main.js 文件,不利于维护。所以我们可以将这些**配置独立出来,正如现在讲述的路由配置,我们可以将它独立到一个`.js`文件内**

```js
import Vue from 'vue'
import Router from 'vue-router'
// 引入四个页面
import Home from './Home.vue'
import Explorer from './Explorer.vue'
import Cart from './Cart.vue'
import Me from './Me.vue'
// 使用路由实例插件
Vue.use(Router)


export default new Router({
    mode: 'history',
    base: __dirname,
    routes: [
        {path: '/home',component:Home},
        {path: '/explorer',component:Explorer},
        {path: '/cart',component:Cart},
        {path: '/me',component:Me},
    ]
})

```
这里我们放入 `src/router/index.js` 下

# 路由的模式

传统意义上路由是由多个URL或者URL规则组成的，对服务端而言，网页的访问是无状态的，称之为服务端路由。而浏览器的 **History API则给予了一种实现可状态化页面的可能，** 因为页面的跳转并不出现页面刷新,这样 **状态就被维护在游览器的 History 的内部状态存储之中。**

前文中,我们创建 VueRouter 实例时用了 mode:history 的参数,这个值的意思是使用 history 模式,这种模式充分利用了 ** history.pushState API 来完成 URL 跳转而无须重新加载页面**

如果不使用 history 模式, 当访问 home 的时候地址就会变为:

```
http://localhost/#home
```
反之为:
```
http://localhost/home
```

下面三种模式:
- Hash:使用 URL hash 值来作为路由。支持所以游览器,包括不支持 HTML5 History API 的游览器

- History: 依赖 HTML5 History API 和 服务器配置。

- Abstract: 支持所有 JavaScript 运行环境,如 Node.js 服务器端。如果没有发现有没有游览器的 API,路由会自动强制进入这个模式

base 为应用的基路径。例如:整个单页应用服务在 `/app/`下,那么base就应该设为"/app/",当你在 HTML5 history 模式下使用 base 选项之后,所有的 to 属性都不需要写基路径

# 路由与导航
刚才我们建立了路由与组件之间的关系,接下来就要将这些路由关系在视图中互动起来

> 思路:当我们点击下方的主导航区切换路由,组件容器就应该渲染相应的组件,其实这也就是 vue-router 所提供的功能

vue-router 提供了两个指令标签(directive) 组件来处理这个导航与自动渲染逻辑:

- `<router-view>` 渲染路径匹配到的视图组件,它还可以内嵌自己的 `<router-view>` ,根据嵌套路径渲染嵌套组件

- `<router-link>`支持用户在具有路由功能的应用中(点击)导航

![](http://ww1.sinaimg.cn/mw690/006rAlqhgy1g322qpd5lqj308j0ejaa8.jpg)

接下来我们就在 App.vue 文件内用 `<router-view>` 和 `<router-link>` 改写`<template>`模板

```html
<template>
  <div id="app">
    <div class="tabs">
        <ul>
          <li>
            <!-- 使用 router-link指向定义的path -->
            <router-link to="/home">
                <div></div>
                <div>首页</div>
            </router-link>
          </li>
          <li>
            <router-link to="/explorer">
                <div></div>
                <div>探索</div>
            </router-link>
          </li>
          <li>
            <router-link to="/cart">
                <div></div>
                <div>购物车</div>
            </router-link>
          </li>
          <li>
            <router-link to="/me">
                <div></div>
                <div>我</div>
            </router-link>
          </li>
        </ul>
    </div>
    <div class="content">
        <!-- 用router-view 渲染视图 -->
        <router-view></router-view>
    </div>
  </div>
</template>
```

> 问题:
- `<router-link>` 的 to 属性内显式地引用路径(如:to="/me") 的做法对吗?
- 这个路径不是在 VueRouter 的全局配置中出现过吗?
- 万一需要修改这个 URL 怎么办,在使用过的地方都要改一次?

**无论我们是做服务端开发还是前端开发,路由的使用都有一个明确的原则,不直接引用路由定义**

vue-router 提供了一种隐式的路由引用方式,vue-router 将之称为 "命名路由",简单点说就是通过路由的名称引用取代 URL 的直接引用。先在 VueRouter 的配置上做重构:

```js
routes: [
    {
      path: '/',
      name: 'Home',
      component: Home
    },
    {
      path: '/explorer',
      name: 'Explorer',
      component: Explorer
  },
  //略
]
```
在 `<router-link>` 内通过名称引用路由需要向 to 属性传入一个对象显式声明路由的名称:

```xml
<router-link :to="{ name : 'Home'}">
```
> 注意是 `:to` 而不是 `to`,这个时候是向 `<router-link>` 传入的是一个对象 {name : 'Home'}而不是字符串:


```html
<template>
  <div id="app">
    <div class="tabs">
        <ul>
          <li>
            <!-- 使用 router-link指向定义的path -->
            <router-link :to="{ name : 'Home' }">
                <div></div>
                <div>首页</div>
            </router-link>
          </li>
          <li>
            <router-link :to="{name : 'Explorer'}">
                <div></div>
                <div>探索</div>
            </router-link>
          </li>
          <li>
            <router-link :to="{name : 'Cart'}">
                <div></div>
                <div>购物车</div>
            </router-link>
          </li>
          <li>
            <router-link :to="{name:'Me'}">
                <div></div>
                <div>我</div>
            </router-link>
          </li>
        </ul>
    </div>
    <div class="content">
        <!-- 用router-view 渲染视图 -->
        <router-view></router-view>
    </div>
  </div>
</template>
```
>  切记:虽然命名路由的方式会比直接引用 path 多写一些代码,但这是值得的,因为一旦遇到路径的修改只需要在 main.js 的全局路由设置中进行修改而不用在每个用到的地方都改一次(修改path就可以)

## 输出指定元素

`<router-link>` 组件支持用户在具有路由功能的应用中。通过 to 属性指定目标地址,默认渲染成带有正确链接的 `<a>`标签。第一种输出结构：

```html
<ul>
    <li>
        <a href="#">
            <div>首页</div>
        </a>
    </li>   
</ul>
```


![](http://ww1.sinaimg.cn/large/006rAlqhly1g324wsjqgsj30hq02r748.jpg)
> flag: 实际与书上应该版本不同

其实我们并不需要输出 `<a>` 元素标记,因为我们没有具体的链接地址,由 `<li>` 元素同样可以处理来自用户的点击切换路由的事件。`<router-link>` 可以通过配置 tag 属性生成别的标签:

```html
<router-link :to="{ name : 'Home' }" tag="li">
               <div></div>
               <div>首页</div>
           </router-link>
```

## 动态路由

现在我们已经建立整个微信网上书城的入口结构以及顶层导航结构了,因为 4 个顶层页面还没有内容,所有由顶层页面作为导航入口进入的二级和三级页面还没有创建路由,它们是:

- 图书详情 (BookDetails)
- 结算 (Checkout)
- 收货地址 (Address)
- 个人资料 (Profile)
- 订单 (Orders)
