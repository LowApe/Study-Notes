# Dockeråˆè¯†å®¹å™¨

```flow
st=>start: Start
e=>end
one=>operation: IBMå¤§å‹ä¸»æœºè™šæ‹ŸåŒ–
two=>operation: Xen\KVMä»£è¡¨çš„è™šæ‹Ÿæœºè™šæ‹ŸåŒ–
three=>operation: Docker
st->one->two->three->e
```

## 1 ä»€ä¹ˆæ˜¯Docker

> Docker æ˜¯åŸºäº Go è¯­è¨€å®ç°çš„å¼€æºå®¹å™¨é¡¹ç›®ã€‚ç›®å‰å·²æœ‰å¤šä¸ªç›¸å…³é¡¹ç›®(åŒ…æ‹¬ Docker ä¸‰å‰‘å®¢ã€Kubernetesç­‰)ï¼Œé€æ¸å½¢æˆäº†å›´ç»•Dockerå®¹å™¨çš„ç”Ÿæ€ä½“ç³»ã€‚

Docker çš„æ„æƒ³ï¼Œå¯¹åº”ç”¨å°è£…ã€åˆ†å‘ã€éƒ¨ç½²ã€è¿è¡Œç”Ÿå‘½å‘¨æœŸè¿›è¡Œç®¡ç†ï¼Œè¾¾åˆ°åº”ç”¨ç»„ä»¶ **ä¸€æ¬¡å°è£…ï¼Œåˆ°å¤„è¿è¡Œ**ã€‚

- è¿™é‡Œçš„åº”ç”¨ç»„ä»¶ï¼Œæ—¢å¯ä»¥æ˜¯ä¸€ä¸ª Web åº”ç”¨ã€ä¸€ä¸ªç¼–è¯‘ç¯å¢ƒï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€å¥—æ•°æ®åº“å¹³å°æœåŠ¡ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿæˆ–é›†ç¾¤

ç®€å•åœ°è®²ï¼Œå¯ä»¥å°† Dockerå®¹å™¨ç†è§£ä¸ºè½»é‡çº§çš„æ²™ç›’ã€‚æ¯ä¸ªå®¹å™¨å†…è¿è¡Œç€ä¸€ä¸ªåº”ç”¨ï¼Œä¸åŒçš„å®¹å™¨ç›¸äº’éš”ç¦»ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œäº’ç›¸é€šä¿¡ã€‚å®¹å™¨çš„åˆ›å»ºå’Œåœæ­¢éƒ½ååˆ†å¿«é€Ÿï¼Œå‡ ä¹è·Ÿåˆ›å»ºå’Œç»ˆæ­¢åŸç”Ÿåº”ç”¨ä¸€è‡´ã€‚å®¹å™¨è‡ªèº«å¯¹ç³»ç»Ÿèµ„æºçš„é¢å¤–éœ€æ±‚ä¹Ÿååˆ†æœ‰é™ï¼Œè¿œè¿œä½äºä¼ ç»Ÿè™šæ‹Ÿæœº

## 2 ä¸ºä»€ä¹ˆä½¿ç”¨ Docker

- Docker å¯ä»¥æ‘†è„±åº•å±‚ç‰©ç†ç¡¬ä»¶çš„é™åˆ¶
- æä¾›ä¸€ç§æ–°å‹çš„åˆ›å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„æ–¹å¼
- Docker é€šè¿‡å®¹å™¨æ¥æ‰“åŒ…åº”ç”¨ã€è§£è€¦åº”ç”¨å’Œè¿è¡Œå¹³å°

> ä¾‹å¦‚ï¼šä¼ ç»Ÿçš„ LAMP æ­å»ºéœ€è¦é…ç½®ç›¸åº”çš„ç¯å¢ƒã€å‚æ•°ï¼Œå½“æœåŠ¡å™¨è¿ç§»ï¼Œå°±ä¼šå¯¹åº”ç”¨é‡æ–°éƒ¨ç½²å’Œè°ƒè¯•ã€‚å…¶æ ¹æºï¼Œæ˜¯è¿™äº›å› æœé‚£ä¸ªç›´æ¥è¿è¡Œåœ¨åº•å±‚æ“ä½œç³»ç»Ÿä¸Šï¼Œæ— æ³•ä¿è¯åŒä¸€ä»½åº”ç”¨åœ¨ä¸åŒç¯å¢ƒä¸­è¡Œä¸ºä¸€è‡´

**Dockerå¼€å‘å’Œè¿ç»´çš„ä¼˜åŠ¿**

- æ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²
- æ›´é«˜æ•ˆçš„èµ„æºåˆ©ç”¨(å†…æ ¸çº§çš„è™šæ‹ŸåŒ–)
- æ›´ç®€å•çš„æ›´æ–°ç®¡ç†(Dockerfile)

**Dcoker ä¸ è™šæ‹Ÿæœºæ¯”è¾ƒ**

- Docker å®¹å™¨å¯åŠ¨å’Œåœæ­¢å¯ä»¥åœ¨ç§’çº§å®ç°ï¼Œä¼ ç»Ÿè™šæ‹Ÿæœºéœ€è¦æ•°åˆ†é’Ÿ
- Docker å®¹å™¨å¯¹ç³»ç»Ÿèµ„æºéœ€æ±‚å¾ˆå°‘ï¼Œä¸€å°ä¸»æœºå¯ä»¥è¿è¡Œæ•°åƒä¸ª Dokcer å®¹å™¨
- Docker é€šè¿‡ç±»ä¼¼ Git è®¾è®¡ç†å¿µçš„æ“ä½œæ¥æ–¹ä¾¿ç”¨æˆ·è·å–ã€åˆ†å‘å’Œæ›´æ–°åº”ç”¨é•œåƒï¼Œå­˜å‚¨å¤ç”¨ï¼Œå¢é‡æ›´æ–°
- Docker é€šè¿‡ Dockerfile æ”¯æŒçµæ´»çš„è‡ªåŠ¨åŒ–åˆ›å»ºå’Œéƒ¨ç½²æœºåˆ¶ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œä½¿æµç¨‹æ ‡å‡†åŒ–

## 3 Docker ä¸è™šæ‹ŸåŒ–

> åœ¨è®¡ç®—é¢†åŸŸï¼Œè®¡ç®—æœºè™šæ‹ŸåŒ–ï¼Œé€šå¸¸è¯´çš„æœåŠ¡å™¨è™šæ‹ŸåŒ–ã€‚
>
> ä»å¤§ç±»ä¸Šåˆ†ï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯å¯åˆ†ä¸ºåŸºäº
>
> - **ç¡¬ä»¶çš„è™šæ‹ŸåŒ–**(ç½‘å¡å•æ ¹å¤š IO è™šæ‹ŸåŒ–)
> -  **è½¯ä»¶çš„è™šæ‹ŸåŒ–**
> 	- åº”ç”¨è™šæ‹ŸåŒ–
> 	- å¹³å°è™šæ‹ŸåŒ–(é€šå¸¸è¯´çš„è™šæ‹ŸæœºæŠ€æœ¯)
> 		- å®Œå…¨è™šæ‹ŸåŒ–(å¦‚ VM)
> 		- ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–(å¦‚KVM)
> 		- éƒ¨åˆ†è™šæ‹ŸåŒ–
> 		- å‡†è™šæ‹ŸåŒ–
> 		- æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1gke1f3sy93j30wa0fs0xv.jpg)

Docker å®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤æ›´åŠ è½»é‡

# Dockeræ ¸å¿ƒæ¦‚å¿µä¸å®‰è£…é…ç½®

æœ¬èŠ‚ä¸»è¦ä»‹ç» Docker çš„ä¸‰å¤§æ ¸å¿ƒæ¦‚å¿µ

- é•œåƒ(image)
- å®¹å™¨(Container)
- ä»“åº“(Repository)



## 1 æ ¸å¿ƒæ¦‚å¿µ

**Dockeré•œåƒ**

Docker é•œåƒç±»ä¼¼äºè™šæ‹Ÿæœºé•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåªè¯»çš„æ¨¡ç‰ˆã€‚é€šè¿‡ç‰ˆæœ¬ç®¡ç†å’Œå¢é‡çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒDocker æä¾›äº†ä¸€å¥—ååˆ†ç®€å•çš„æœºåˆ¶æ¥åˆ›å»ºå’Œæ›´æ–°ç°æœ‰çš„é•œåƒã€‚ç”¨æˆ·ç”šè‡³å¯ä»¥ä»ç½‘ä¸Šä¸‹è½½ä¸€ä¸ªå·²ç»åšå¥½çš„åº”ç”¨é•œåƒï¼Œå¹¶ç›´æ¥ä½¿ç”¨

**Dockerå®¹å™¨**

Dockerå®¹å™¨ç±»ä¼¼äºä¸€ä¸ªè½»é‡çº§çš„æ²™ç®±ï¼Œ**Docker åˆ©ç”¨å®¹å™¨æ¥è¿è¡Œå’Œéš”ç¦»åº”ç”¨**ã€‚å®¹å™¨æ˜¯ä»é•œåƒåˆ›å»ºçš„åº”ç”¨è¿è¡Œå®ä¾‹ã€‚ğŸ¤”(è§£é‡Šçš„é‚£ä¹ˆæ‹—å£) å¯ä»¥å°†å…¶å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ï¼Œè€Œè¿™äº›å®¹å™¨éƒ½æ˜¯å½¼æ­¤ç›¸äº’éš”ç¦»çš„ï¼Œä¸å¯è§çš„ã€‚å¯ä»¥æŠŠå®¹å™¨çœ‹åšæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Linux ç³»ç»Ÿç¯å¢ƒ(åŒ…æ‹¬root ç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰)ä»¥åŠè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºæ‰“åŒ…çš„ç›’å­ã€‚

> âš ï¸ é•œåƒè‡ªèº«æ˜¯åªè¯»çš„ã€‚å®¹å™¨ä»é•œåƒå¯åŠ¨çš„æ—¶å€™ï¼Œä¼šåœ¨é•œåƒçš„æœ€ä¸Šå±‚åˆ›å»ºä¸€ä¸ªå¯å†™å±‚ã€‚ğŸ¤”ï¼Ÿå¯ä»¥åšä»€ä¹ˆï¼Ÿï¼Ÿä¹Ÿä¸è¯´ä¸‹å»å¯ä»¥åšä»€ä¹ˆï¼Ÿï¼Ÿ

**Docker ä»“åº“**

Docker ä»“åº“ç±»ä¼¼äºä»“åº“ï¼Œå®ƒæ˜¯Docker é›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶çš„åœºæ‰€

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1gkgyhmeis2j30wm0jijvn.jpg)

æ ¹æ®æ‰€å­˜å‚¨çš„é•œåƒå…¬å¼€åˆ†äº«ä¸å¦ï¼Œ Docker ä»“åº“å¯ä»¥åˆ†ä¸ºå…¬å¼€ä»“åº“(Public)å’Œç§æœ‰ä»“åº“(Private)ä¸¤ç§å½¢å¼ã€‚ç›®å‰ï¼Œæœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯å®˜æ–¹æä¾›çš„ Docker Hubï¼Œå…¶ä¸­å­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ã€‚å›½å†…ä¸å°‘äº‘æœåŠ¡æä¾›å•†(å¦‚æ—¶é€Ÿäº‘ã€é˜¿é‡Œäº‘)ä¹Ÿæä¾›äº†ä»“åº“çš„æœ¬åœ°æºï¼Œå¯ä»¥æä¾›ç¨³å®šçš„å›½å†…è®¿é—®

**Docker åˆ©ç”¨ä»“åº“ç®¡ç†é•œåƒçš„è®¾è®¡ç†å¿µä¸Gitéå¸¸ç›¸ä¼¼ï¼Œå®é™…ä¸Šåœ¨ç†å¿µä¸Šè®¾è®¡å€Ÿé‰´äº† Git çš„å¾ˆå¤šä¼˜ç§€æ€æƒ³**

## 2 å®‰è£… Docker 

è®¿é—®[å®˜ç½‘ä¸‹è½½](https://docs.docker.com/engine/install/centos/)

ç›®å‰Docker æ”¯æŒï¼š

- Docker Platformï¼šæ”¯æŒåœ¨æ¡Œé¢ç³»ç»Ÿæˆ–äº‘å¹³å°å®‰è£… Docker
- DockerHubï¼šå®˜æ–¹æä¾›çš„äº‘æ‰˜ç®¡æœåŠ¡ï¼Œå¯ä»¥æä¾›å…¬æœ‰æˆ–ç§æœ‰çš„é•œåƒä»“åº“
- DockerCloudï¼šå®˜æ–¹æä¾›çš„å®¹å™¨äº‘æœåŠ¡ï¼Œå¯ä»¥å®Œæˆå®¹å™¨çš„éƒ¨ç½²å’Œç®¡ç†ï¼Œå¯ä»¥å®Œæ•´åœ°æ”¯æŒå®¹å™¨åŒ–é¡¹ç›®ï¼Œè¿˜æœ‰ CIã€CD åŠŸèƒ½
- Docker DataCenterï¼šæä¾›ä¼ä¸šçº§çš„ç®€å•å®‰å…¨å¼¹æ€§çš„å®¹å™¨é›†ç¾¤ç¼–æ’å’Œç®¡ç†

### 1 Ubuntu ç¯å¢ƒå®‰è£…Docker

### 2 CentOS ç¯å¢ƒä¸‹å®‰è£… Docker

é¦–å…ˆï¼Œä¹Ÿæ˜¯è¦å®‰è£… yum è½¯ä»¶æº(å¦‚æœæ²¡æœ‰dockerçš„æºåœ°å€)ï¼šğŸ¤”è²Œä¼¼å¯ä»¥é…ç½®å›½å†…çš„æº

```shell
sudo tee /etc/yum.repos.d/docker.repo <<-'EOF'
[dockerrepo]
name=Docker Repository
baseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/
enabled=1
gpgcheck=1
gpgkey=https://yum.dockerproject.org/gpg
EOF
```

å®˜ç½‘çš„æ–¹æ³•

```shell
# å®‰è£… yum å·¥å…·ï¼Ÿï¼Ÿ
$ sudo yum install -y yum-utils
# é…ç½®dockerä¸‹è½½ä»“åº“åœ°å€ï¼Ÿ
$ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
# yum å®‰è£… docker-ce docker-ce-cli
$ sudo yum install docker-ce docker-ce-cli containerd.io
# å®‰è£…å®Œæˆåæµ‹è¯•
$ docker --version
Docker version 19.03.13, build 4484c46d9d
# å¦‚æœæƒ³å®‰è£…å…¶ä»–ç‰ˆæœ¬ é»˜è®¤æ˜¾ç¤ºæœ€æ–°ï¼Œ --showduplicates æ˜¾ç¤ºå¤šç‰ˆæœ¬ ï¼Œ
# | sort -r å°†å¤šç‰ˆæœ¬åˆ—è¡¨æ’åº -r åè½¬æ’åº
$ yum list docker-ce --showduplicates | sort -r
# å®‰è£…å…¶ä»–ç‰ˆæœ¬
$ sudo install docker-ce-<version_string> docker-ce-cli-<version_streing> containerd.io
# å¯åŠ¨ docker
$ sudo systemctl start docker
# è¿è¡Œ hello-world é•œåƒ
$ sudo docker run hello-world
```

ä¹Ÿå¯ä»¥ä½¿ç”¨shellè„šæœ¬ä¸‹è½½

> è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿä¿¡æ¯å¹¶è¿›è¡Œç›¸åº”é…ç½®ï¼š`curl -fsSL https://get.docker.com/ | sh` ç½‘å€é‡Œæ˜¯è„šæœ¬ï¼Œå‘½ä»¤çš„æ„æ€ï¼Œå°†ç½‘ç«™çš„ä¿¡æ¯è¾“å…¥åˆ° sh å‘½ä»¤

### 3 Mac OS ç¯å¢ƒä¸‹å®‰è£…Docker



### 4 Windows ç¯å¢ƒä¸‹å®‰è£…Docker

## 3 é…ç½®Docker æœåŠ¡

 ä¸ºäº†é¿å…æ¯æ¬¡ä½¿ç”¨ docker å‘½ä»¤éƒ½éœ€è¦ç”¨ç‰¹æƒèº«ä»½ï¼Œå¯ä»¥å°†å½“å‰ç”¨æˆ·åŠ å…¥å®‰è£…ä¸­è‡ªåŠ¨åˆ›å»ºçš„dockerç”¨æˆ·ç»„ï¼š

```shell
$ sudo usermod -aG docker USER_NAME(æ³¨æ„ä¸è¦ä¿®æ”¹è™šæ‹Ÿæœºå›¾å½¢ç•Œé¢çš„ç”¨æˆ·)
```

ç”¨æˆ·æ›´æ–°ç»„åï¼Œé€€å‡ºå¹¶é‡æ–°ç™»é™†åå³å¯ç”Ÿæ•ˆ

**Docker æœåŠ¡æ”¯æŒå¤šç§å¯åŠ¨å‚æ•°**ï¼ŒUbunntuçš„Docker æœåŠ¡é»˜è®¤é…ç½®æ–‡ä»¶ä¸º `/etc/default/docker`å¯ä»¥ä¿®æ”¹å…¶ä¸­çš„ docker_ops æ¥ä¿®æ”¹æœåŠ¡å¯åŠ¨çš„å‚æ•°ï¼Œä¾‹å¦‚

```shell
# docker æœåŠ¡å¯ä»¥é€šè¿‡æœ¬åœ° 2375 ç«¯å£æ¥æ”¶æ¥è‡ªå¤–éƒ¨çš„è¯·æ±‚
$ docker_opts="$docker_opts -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"
# ä¿®æ”¹åé‡å¯æœåŠ¡
$ sudo service docker restart
```

Docker æœåŠ¡ç®¡ç†è„šæœ¬ä¸º `/etc/init.d/docker`ï¼ˆcentos æ²¡æœ‰ï¼‰

```sh
cat docker
#!/bin/sh
set -e

### BEGIN INIT INFO
# Provides:           docker
# Required-Start:     $syslog $remote_fs
# Required-Stop:      $syslog $remote_fs
# Should-Start:       cgroupfs-mount cgroup-lite
# Should-Stop:        cgroupfs-mount cgroup-lite
# Default-Start:      2 3 4 5
# Default-Stop:       0 1 6
# Short-Description:  Create lightweight, portable, self-sufficient containers.
# Description:
#  Docker is an open-source project to easily create lightweight, portable,
#  self-sufficient containers from any application. The same container that a
#  developer builds and tests on a laptop can run at scale, in production, on
#  VMs, bare metal, OpenStack clusters, public clouds and more.
### END INIT INFO

export PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin

BASE=docker

# modify these in /etc/default/$BASE (/etc/default/docker)
DOCKERD=/usr/bin/dockerd
# This is the pid file managed by docker itself
DOCKER_PIDFILE=/var/run/$BASE.pid
# This is the pid file created/managed by start-stop-daemon
DOCKER_SSD_PIDFILE=/var/run/$BASE-ssd.pid
DOCKER_LOGFILE=/var/log/$BASE.log
DOCKER_OPTS=
DOCKER_DESC="Docker"

# Get lsb functions
. /lib/lsb/init-functions

if [ -f /etc/default/$BASE ]; then
	. /etc/default/$BASE
fi

# Check docker is present
if [ ! -x $DOCKERD ]; then
	log_failure_msg "$DOCKERD not present or not executable"
	exit 1
fi

check_init() {
	# see also init_is_upstart in /lib/lsb/init-functions (which isn't available in Ubuntu 12.04, or we'd use it directly)
	if [ -x /sbin/initctl ] && /sbin/initctl version 2>/dev/null | grep -q upstart; then
		log_failure_msg "$DOCKER_DESC is managed via upstart, try using service $BASE $1"
		exit 1
	fi
}

fail_unless_root() {
	if [ "$(id -u)" != '0' ]; then
		log_failure_msg "$DOCKER_DESC must be run as root"
		exit 1
	fi
}

cgroupfs_mount() {
	# see also https://github.com/tianon/cgroupfs-mount/blob/master/cgroupfs-mount
	if grep -v '^#' /etc/fstab | grep -q cgroup \
		|| [ ! -e /proc/cgroups ] \
		|| [ ! -d /sys/fs/cgroup ]; then
		return
	fi
	if ! mountpoint -q /sys/fs/cgroup; then
		mount -t tmpfs -o uid=0,gid=0,mode=0755 cgroup /sys/fs/cgroup
	fi
	(
		cd /sys/fs/cgroup
		for sys in $(awk '!/^#/ { if ($4 == 1) print $1 }' /proc/cgroups); do
			mkdir -p $sys
			if ! mountpoint -q $sys; then
				if ! mount -n -t cgroup -o $sys cgroup $sys; then
					rmdir $sys || true
				fi
			fi
		done
	)
}

case "$1" in
	start)
		check_init

		fail_unless_root

		cgroupfs_mount

		touch "$DOCKER_LOGFILE"
		chgrp docker "$DOCKER_LOGFILE"

		ulimit -n 1048576

		# Having non-zero limits causes performance problems due to accounting overhead
		# in the kernel. We recommend using cgroups to do container-local accounting.
		if [ "$BASH" ]; then
			ulimit -u unlimited
		else
			ulimit -p unlimited
		fi

		log_begin_msg "Starting $DOCKER_DESC: $BASE"
		start-stop-daemon --start --background \
			--no-close \
			--exec "$DOCKERD" \
			--pidfile "$DOCKER_SSD_PIDFILE" \
			--make-pidfile \
			-- \
				-p "$DOCKER_PIDFILE" \
				$DOCKER_OPTS \
					>> "$DOCKER_LOGFILE" 2>&1
		log_end_msg $?
		;;

	stop)
		check_init
		fail_unless_root
		if [ -f "$DOCKER_SSD_PIDFILE" ]; then
			log_begin_msg "Stopping $DOCKER_DESC: $BASE"
			start-stop-daemon --stop --pidfile "$DOCKER_SSD_PIDFILE" --retry 10
			log_end_msg $?
		else
			log_warning_msg "Docker already stopped - file $DOCKER_SSD_PIDFILE not found."
		fi
		;;

	restart)
		check_init
		fail_unless_root
		docker_pid=`cat "$DOCKER_SSD_PIDFILE" 2>/dev/null`
		[ -n "$docker_pid" ] \
			&& ps -p $docker_pid > /dev/null 2>&1 \
			&& $0 stop
		$0 start
		;;

	force-reload)
		check_init
		fail_unless_root
		$0 restart
		;;

	status)
		check_init
		status_of_proc -p "$DOCKER_SSD_PIDFILE" "$DOCKERD" "$DOCKER_DESC"
		;;

	*)
		echo "Usage: service docker {start|stop|restart|status}"
		exit 1
		;;
esac
```

**å¯¹äº CentOSã€RedHatç­‰ç³»ç»Ÿï¼ŒæœåŠ¡å¯èƒ½æ˜¯é€šè¿‡ systemd æ¥ç®¡ç†çš„**

```shell
#
$ sudo systemctl start docker.service
# å…¶å®service ä¹Ÿè¡Œï¼Œç»“æœéƒ½æ˜¯è½¬æˆäº† systemctl
$ service docker restart
Redirecting to /bin/systemctl restart docker.service

```

**å¦‚æœæœåŠ¡ä¸æ­£å¸¸ï¼Œå¯ä»¥æŸ¥çœ‹ docker æœåŠ¡çš„æ—¥å¿—ä¿¡æ¯æ¥ç¡®å®šé—®é¢˜**,ubuntu æ—¥å¿—`/var/log/upstart/docker.log`

```shell
# æ¯æ¬¡é‡å¯ Docker æœåŠ¡åï¼Œé€šè¿‡æŸ¥çœ‹ Docker ç‰ˆæœ¬ä¿¡æ¯ï¼Œç¡®ä¿æœåŠ¡å·²ç»æ­£å¸¸è¿è¡Œ
$ docker version
```

# Dockeré•œåƒçš„ä½¿ç”¨

> Docker è¿è¡Œå®¹å™¨å‰éœ€è¦æœ¬åœ°å­˜åœ¨å¯¹åº”çš„é•œåƒï¼Œå¦‚æœé•œåƒæ²¡ä¿å­˜åœ¨æœ¬åœ°ï¼ŒDocker ä¼šå°è¯•å…ˆä»é»˜è®¤é•œåƒä»“åº“ä¸‹è½½(é»˜è®¤ä½¿ç”¨ Docker Hub å…¬å…±æ³¨å†ŒæœåŠ¡å™¨ä¸­çš„ä»“åº“)ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„é•œåƒä»“åº“

æœ¬èŠ‚å†…å®¹

- pull å‘½ä»¤ä¸‹è½½é•œåƒåˆ°æœ¬åœ°
- å¦‚ä½•æŸ¥çœ‹æœ¬åœ°å·²æœ‰çš„é•œåƒä¿¡æ¯å’Œç®¡ç†é•œåƒæ ‡ç­¾ï¼Œ
- åœ¨è¿œç¨‹ä»“åº“ä½¿ç”¨search å‘½ä»¤è¿›è¡Œæœç´¢è¿‡æ»¤
- åˆ é™¤é•œåƒæ ‡ç­¾å’Œé•œåƒæ–‡ä»¶
- åˆ›å»ºç”¨æˆ·å®šåˆ¶çš„é•œåƒå¹¶ä¸”ä¿å­˜ä¸ºå¤–éƒ¨æ–‡ä»¶
- å¾€ Docker Hub ä»“åº“ä¸­æ¨é€è‡ªå·±çš„é•œåƒ

## 1 è·å–é•œåƒ

```shell
# docker pull è¯­æ³•
docker pull [options] name[:tag|@digest]
# options
# -a è·å–ä»“åº“ä¸­æ‰€æœ‰é•œåƒï¼Œé»˜è®¤ä¸º å¦
# 
# ä¾‹å¦‚è·å–æœ€æ–°çš„ ubunut:lastest é•œåƒ
$ docker pull ubuntu
```

- é€šå¸¸æƒ…å†µä¸‹ï¼Œæè¿°ä¸€ä¸ªé•œåƒéœ€è¦åŒ…æ‹¬â€œåç§°+æ ‡ç­¾â€ä¿¡æ¯
- å¦‚æœä¸æ˜¾å¼æŒ‡å®š TAGï¼Œåˆ™é»˜è®¤ä¼šé€‰æ‹© latest æ ‡ç­¾
- ä¸¥æ ¼è®²ï¼Œé•œåƒçš„ä»“åº“åç§°ä¸­è¿˜åº”è¯¥æ·»åŠ ä»“åº“åœ°å€ä½œä¸ºå‰ç¼€ï¼Œ`docker pull registry.hub.docker.com.ubuntu`,å½“ç„¶é»˜è®¤æ˜¯ Docker Hubï¼Œéå®˜æ–¹ä»“åº“ï¼Œåˆ™éœ€è¦åœ¨ä»“åº“åç§°å‰æŒ‡å®šå®Œæ•´çš„ä»“åº“åœ°å€

åˆ›å»ºä¸€ä¸ªé•œåƒçš„å®¹å™¨,åœ¨å…¶ä¸­è¿è¡Œ bash å¼•ç”¨

```shell
$ docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
postgres              latest              b97bae343e06        5 months ago        313MB
jenkinsci/blueocean   latest              85ea0df70888        5 months ago        568MB
hello-world           latest              bf756fb1ae65        10 months ago       13.3kB

$ docker run -it 85ea0df70888 bash
```



## 2 æŸ¥çœ‹é•œåƒä¿¡æ¯

### 1 images åˆ—å‡ºæ‰€æœ‰é•œåƒ

```shell
# æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰é•œåƒ
$ docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
postgres              latest              b97bae343e06        5 months ago        313MB
jenkinsci/blueocean   latest              85ea0df70888        5 months ago        568MB
hello-world           latest              bf756fb1ae65        10 months ago       13.3kB

```

- repository æ¥è‡ªå“ªä¸€ä¸ªä»“åº“
- tag é•œåƒçš„æ ‡ç­¾ä¿¡æ¯
- image id é•œåƒçš„Id
- created åˆ›å»ºæ—¶é—´
- size é•œåƒçš„å¤§å°

### 2 ä½¿ç”¨tagå‘½ä»¤æ·»åŠ é•œåƒæ ‡ç­¾

docker tag å‘½ä»¤ä¸ºæœ¬åœ°é•œåƒæ·»åŠ æ–°çš„æ ‡ç­¾

```shell
$ docker tag ubuntu:latest myubuntu:latest
```

å†æ¬¡ä½¿ç”¨ docker images åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šé•œåƒä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°å¤šä¸€ä¸ªé•œåƒ

```shell
# docker tag hello-world:latest myhello:latest
root@iZuf6aytwpcvzkwiisgaxaZ:log# docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
postgres              latest              b97bae343e06        5 months ago        313MB
jenkinsci/blueocean   latest              85ea0df70888        5 months ago        568MB
hello-world           latest              bf756fb1ae65        10 months ago       13.3kB
myhello               latest              bf756fb1ae65        10 months ago       13.3kB
```

> tag åçš„é•œåƒ imgaeIdç›¸åŒ

### 3 ä½¿ç”¨ inspect å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

ä½¿ç”¨ docker inspect å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯,è¿”å›çš„æ˜¯ä¸€ä¸ª JSONæ ¼å¼çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬åªè¦å…¶ä¸­ä¸€é¡¹å†…å®¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•° -f æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼Œè·å–é•œåƒçš„ Architecture

```shell
 docker inspect myhello -f {{".Architecture"}}
amd64
```



### 4 ä½¿ç”¨ history å‘½ä»¤æŸ¥çœ‹é•œåƒå†å²

é•œåƒæ–‡ä»¶ç”±å¤šä¸ªå±‚ç»„æˆï¼Œé‚£ä¹ˆæ€ä¹ˆçŸ¥é“å„ä¸ªå±‚çš„å†…å®¹å…·ä½“æ—¶ä»€ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨ history å­å‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†åˆ—å‡ºå„å±‚çš„åˆ›å»ºä¿¡æ¯

```shell
# --no-trunc æ˜¾ç¤ºæˆªæ–­ä¿¡æ¯
docker history hello-world:latest --no-trunc
```

## 3 æœå¯»é•œåƒ

ä½¿ç”¨ docker search å‘½ä»¤å¯ä»¥æœç´¢è¿œç«¯ä»“åº“ä¸­å…±äº«çš„é•œåƒï¼Œé»˜è®¤æœç´¢å®˜æ–¹ä»“åº“ä¸­çš„é•œåƒã€‚ç”¨æ³•ä¸º docker search TERM 

```shell
# --automated=true|false ä»…æ˜¾ç¤ºè‡ªåŠ¨åˆ›å»ºçš„é•œåƒï¼Œé»˜è®¤ä¸ºå¦
# --no-trunc=true|false ä¿¡æ¯æˆªæ–­æ˜¾ç¤º
# -s --stars=X:æŒ‡å®šä»…æ˜¾ç¤ºè¯„ä»·ä¸ºæŒ‡å®šæ˜Ÿçº§ä»¥ä¸Šçš„é•œåƒï¼Œé»˜è®¤ä¸º0ï¼Œå³è¾“å‡ºæ‰€æœ‰é•œåƒ

# ä¾‹å¦‚æœç´¢æ‰€æœ‰è‡ªåŠ¨åˆ›å»ºçš„è¯„ä»·ä¸º 1+ çš„å¸¦ nginx å…³é”®å­—çš„é•œåƒ
$ docker search --automated -s 3 nginx
Flag --automated has been deprecated, use --filter=is-automated=true instead
Flag --stars has been deprecated, use --filter=stars=3 instead
NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
jwilder/nginx-proxy                Automated Nginx reverse proxy for docker conâ€¦   1906                                    [OK]
richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable ofâ€¦   791                                     [OK]
tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmpâ€¦   103                                     [OK]
bitnami/nginx                      Bitnami nginx Docker Image                      90                                      [OK]
alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from souâ€¦   80                                      [OK]
jlesage/nginx-proxy-manager        Docker container for Nginx Proxy Manager        65                                      [OK]
nginxdemos/hello                   NGINX webserver that serves a simple page coâ€¦   63                                      [OK]
privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm & Alâ€¦   39                                      [OK]
schmunk42/nginx-redirect           A very simple container to redirect HTTP traâ€¦   19                                      [OK]
staticfloat/nginx-certbot          Opinionated setup for automatic TLS certs loâ€¦   14                                      [OK]
raulr/nginx-wordpress              Nginx front-end for the official wordpress:fâ€¦   13                                      [OK]
flashspys/nginx-static             Super Lightweight Nginx Image                   7                                       [OK]
mailu/nginx                        Mailu nginx frontend                            7                                       [OK]
bitnami/nginx-ingress-controller   Bitnami Docker Image for NGINX Ingress Contrâ€¦   6                                       [OK]
```

## 4 åˆ é™¤é•œåƒ

### 1 ä½¿ç”¨æ ‡ç­¾åˆ é™¤é•œåƒ

```shell
# docker rmi image[image]
$ docker rmi myhello
Untagged: myhello:latest
```

### 2 ä½¿ç”¨é•œåƒIDåˆ é™¤é•œåƒ

> âš ï¸å½“æœ‰è¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨å­˜åœ¨æ—¶ï¼Œé•œåƒæ–‡ä»¶é»˜è®¤æ˜¯æ— æ³•è¢«åˆ é™¤çš„

```shell
$ docker run jenkinsci/blueocean echo "hello! I am here"
$ docker rmi jenkinsci/blueocean
Error response from daemon: conflict: unable to remove repository reference "jenkinsci/blueocean" (must force) - container 82f915fc0c2e is using its referenced image 85ea0df70888
# ä½¿ç”¨ -f å¼ºåˆ¶åˆ é™¤ï¼Œä½†ä¸æ¨èï¼Œåº”è¯¥å…ˆåˆ é™¤ä»¥æ¥è¯¥é•œåƒçš„æ‰€æœ‰å®¹å™¨,ç„¶ååˆ é™¤é•œåƒ
$ docker rm å®¹å™¨ID
```

## 5 åˆ›å»ºé•œåƒ

åˆ›å»ºé•œåƒä¸»è¦ç”±ä¸‰ç§ï¼š

- åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»º
- åŸºäºæœ¬åœ°æ¨¡ç‰ˆå¯¼å…¥
- åŸºäºDockerfileåˆ›å»º

### 1 åŸºäºå·²æœ‰é•œåƒçš„å®¹å™¨åˆ›å»º

```shell
# è¯¥æ–¹æ³•ä¸»è¦æ˜¯ä½¿ç”¨ docker commit å‘½ä»¤
# docker commit[options] container[repository[:TAG]]
# -a,--author="" ä½œè€…ä¿¡æ¯
# -c,--change=[] æäº¤çš„æ—¶å€™æ‰§è¡Œ DockerfileæŒ‡ä»¤
# -m,--message="" æäº¤ä¿¡æ¯
# -p,--pause=true: æäº¤æ—¶æš‚åœå®¹å™¨è¿è¡Œ

# ç¤ºä¾‹
$ docker run -it ubuntu:14.04 /bin/bash
touch test
exit
```

æ­¤æ—¶å®¹å™¨ä¸åŸæ¥çš„é•œåƒç›¸æ¯”ï¼Œå·²ç»å‘ç”Ÿäº†æ”¹å˜ï¼Œä½¿ç”¨ docker commit å‘½ä»¤æ¥æäº¤ä¸€ä¸ªæ–°çš„é•œåƒ

```shell
$ docker commit -m "Added a new file" -a "Docker Newbee" ID test:0.1

# è¿™é‡Œ ID æ˜¯é€šè¿‡ docker ps -a æŸ¥çœ‹åˆ°
docker commit -m "create a image " -a "didiaoyuan" d10064414c92 test:0.1
sha256:450ba8f0773069e73608fb6004a73c387371d60c6eed80645f659f3b3f362af3

$ docker images
REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
test                  0.1                 450ba8f07730        3 minutes ago       568MB
```

### 2 åŸºäºæœ¬åœ°æ¨¡ç‰ˆå¯¼å…¥

ç”¨æˆ·ä¹Ÿå¯ä»¥ç›´æ¥ä»ä¸€ä¸ªæ“ä½œç³»ç»Ÿæ¨¡ç‰ˆæ–‡ä»¶å¯¼å…¥ä¸€ä¸ªé•œåƒï¼Œä¸»è¦ä½¿ç”¨ `docker import`å‘½ä»¤ã€‚

```shell
# å‘½ä»¤æ ¼å¼
docker import[options]file|URL|-[repository[:TAG]]
```

[OpenVZæ¨¡ç‰ˆ](http://openvz.org/Download/templates/precreated) 

```shell
# æ‰¾åˆ°ä¸€ä¸ªæƒ³è¦çš„æ¨¡ç‰ˆè¿æ¥ï¼Œå…ˆä¸‹è½½ä¸‹æ¥
$ wget http://download.openvz.org/template/precreated/ubuntu-14.04-x86_64
# å°†ä¸‹è½½å¥½çš„é•œåƒ import åˆ°docker
$ cat unbunt-xxx-xxx-minimal.tar.gz | docker import -ubuntu:14.04
```

ç„¶åæŸ¥çœ‹æ–°å¯¼å…¥çš„é•œåƒï¼Œä¼šå‘ç°å®ƒå·²ç»åœ¨æœ¬åœ°å­˜åœ¨äº†ï¼š

```shell
docker images

```



## 6 å­˜å‚¨å’Œè½½å…¥é•œåƒ

ç”¨æˆ·å¯ä»¥ä½¿ç”¨ docker save å’Œ docker loadå‘½ä»¤æ¥å­˜å‡ºå’Œè½½å…¥é•œåƒ

```shell
# å­˜å‡ºé•œåƒ
$ docker iamges
# ç”¨æˆ·å¯ä»¥å¤åˆ¶ xxx.tar æ–‡ä»¶å°†è¯¥é•œåƒåˆ†äº«ç»™å…¶ä»–äºº
$ docker save -o xxx.tar ubuntu:xxx

# è½½å…¥é•œåƒ
# å¯ä»¥ä½¿ç”¨ docker load å°†å¯¼å‡ºçš„ tar æ–‡ä»¶å†å¯¼å…¥åˆ°æœ¬åœ°é•œåƒåº“ï¼Œ
$ docker load --input xxx.tar
# æˆ–è€…
$ docker load < xxx.tar
```

## 7 ä¸Šä¼ é•œåƒ

å¯ä»¥å—ç”¨ `docker push` å‘½ä»¤ä¸Šä¼ é•œåƒåˆ°ä»“åº“ï¼Œé»˜è®¤ä¸Šä¼ åˆ° Docker Hub å®˜æ–¹ä»“åº“(éœ€è¦ç™»é™†)

```shell
# æ ¼å¼
docker push NAME[:TAG] [registory_host[:registy_port]/]name[:tag]

$ docker tag test:lastest user/test:lastest
$ docker push user/test:latest
```

