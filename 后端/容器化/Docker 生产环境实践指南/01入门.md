# 入门

## 术语

### 镜像与容器

- 镜像是指文件系统快照或 tar 包
- 容器是指镜像的运行态

### 容器与虚拟机

- 虚拟机持有整个操作系统和应用程序的快照
- 虚拟机运行着自己的内核
- 虚拟机可以运行 Linux 之外的其他操作系统
- 容器只持有应用程序，不过应用程序的概念可以延伸到整个 Linux 发行版🤔
- 容器共享宿主机的内核
- 容器只能运行 Linux ，不过在同一宿主机运行的每个容器都可包含不同的发行版

### 持续集成/持续交付

在应用程序新代码提交或触发其他条件时，系统**自动构建新镜像**并进行部署

### 宿主机管理

设备/配置一台物理服务器或虚拟机以便用于运行 Docker 容器的过程

### 编排

编排在 Docker 生态系统中有多种含义。通常情况下，它包括**调度和集群管理**不过有时也包括了宿主机管理。

编排是一个控制器进程，用于决定在哪里运行容器，以及如何让集群知道可用的服务

### 调度

用于决定哪些容器可以给定的资源约束(如 CPU、内存和IO)运行在哪些宿主机上

### 发现

容器如何公开服务给集群，以及发现如何查找其他服务并与之通信的过程。



### 配置管理

过去常常指 Docker 出现之前的自动化工具，如 Chef 和 Puppet 。大多数的 DevOps 团队正在转移到 Docker 上，以消除这类配置管理系统的复杂度。



## 从开发环境到生产环境

Docker 最好的使用方式是将应用程序预先打包成一个 Docker 镜像。镜像通常包含所有的应用程序代码、运行时的依赖以及系统的需求。

> ⚠️注意：包含数据库凭证和其他敏感信息的配置文件通常在运行时添加，而非内建到镜像中

一个跟常见的生产环境示例是，使用**持续集成/持续交付系统**在应用程序代码或 Dockerfile 文件发生变更时自动构建新镜像

## 使用 Docker 的多种方式

要使用 Docker，并不需要立即从单体应用程序迁移到面向服务架构。

Docker 常用以下场景

- 使用以镜像为基础的部署方式取代类似 Capistrano 的代码部署系统🤔
- 安全地在同一台服务器中运行遗留应用和新应用
- 使用一个工具链循序渐进地迁移到面向服务架构(SOA)
- 管理云端或裸机的水平扩展性和弹性
- 确保从开发环境到预演环境到生产环境跨环境的一致性
- 简化开发人员的机器设置和一致性



> 🌰示例：将应用的后台程序迁移到 Docker 集群中，同时保持网页服务器和数据库服务器不变是开始使用 Docker 的常见示例。
> 另一个实例是将应用的部分 REST API 迁移到 Docker 中运行，前端使用 Nginx 代理在遗留服务和 Docker 集群之间路由通信，通过此类技术，团队可以渐进式地从单体应用无缝地迁移到面向服务架构
>
> 另一个常见的 Docker 用例是跨环境部署一个单一容器，其典型的代码路径是从开发环境到预演环境再到生产环境。容器为整个代码路径提供一个一致的、可测试的环境

## 可预期的情况

**为什么 Docker 在生产环境如此困难**

对生产环境有很多要求：

- 安全可靠的部署、健康检查
- 最小或零停机时间
- 从失败中恢复的能力(回滚)
- 一个集中存储日志的方式
- 一种分析或调试应用的方式
- 一种聚合监控参数的方式

Docker 在可移植性、一致性以及打包具有众多依赖的服务非常有优势，下面是多数团队会因为以下或多个**痛点**而坚持使用 Docker

- 一个应用的不同部分使用大量不同的依赖
- 支持使用旧依赖的遗留应用程序
- 开发团队与 DevOps 之间的工作流问题





