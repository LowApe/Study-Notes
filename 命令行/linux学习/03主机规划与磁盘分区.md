# 目录
# 磁盘分区

## 磁盘连接的方式与设备文件名的关系

磁盘接口
    1. IDE
    2. SATA

一个 IDE 扁平电缆可以连接两个 IDE 设备,通常主机都会提供两个最多四个接口，如果光驱用掉一个,最多接 三块 IDE 设备。两个 IDE 接口被称为 IDE1(primary)及 IDE2(secondary),而每条扁平电缆上面的 IDE 设备可以被区分为 Master (主设备) 与Slave(从设备)
![](http://ww1.sinaimg.cn/large/006rAlqhly1g2uutmy7kyj30ou032t96.jpg)

> 假设你的主机仅有一块 IDE 接口的磁盘,而这块磁盘接在 IDE2 的 Master 上面,请问它在 Linux 操作系统里面的设备文件名是什么?

答:比较上表的设备文件名对照, IDE2  的 Master 设备文件名为 `/dev/hdc`

> 如果你的PC上面有两个SATA磁盘以及一个USB磁盘，而主板上面有六个SATA的插槽。这两个SATA磁盘分别安插在主板上的SATA1,SATA5插槽上，请问这三个磁盘在Linux中的设备文件名是什么？

答:由于是使用检测到的顺序来决定设备文件名,并非与实际插槽代号有关,因此设备的文件名如下:
1. SATAT1 插槽上的文件名: `/dev/sda`
2. SATAT5 插槽上的文件名: `/dev/sdb`
3. USB 磁盘(开机启动才被系统识别): `/dev/sdc`

## 磁盘的组成复习
![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2uvchwb84j30e40afn0k.jpg)

磁盘的第一个扇区主要记录了两个重要的信息,分别是:
    - 主引导分区(Master Boot Record,MBR):可以安装引导加载程序的地方
    - 分区表(partition table) 记录整块硬盘分区的状态

MBR 很重要的,因为当系统开机的时候主动读取这个区块的内容,这样系统才会知道你的程序放在哪里且该如何进行开机。

## 磁盘分区表
开始与结束柱面:那个文件系统的最小单位,也就是分区的最小单位,我们利用参考柱面号码的方式来处理。在分区表所在的 64 bytes 容量中,总共分为四组记录区,每组记录区记录了该区段的起始与结束的柱面号码。若将硬盘以长方形来看,然后将柱面以柱型图来看：

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2uvh8yw18j30lg0ak40p.jpg)
假设上面的硬盘设备文件名为 `/dev/had`时,那么这四个分区在 Linux 系统中的设备名如下所示,重点在于文件名后面会再接一个数字,这个数字与该分区所在的位置有关

- P1:`/dev/hda1`
- P2:`/dev/hda2`
- P3:`/dev/hda3`
- P4:`/dev/hda4`

> 上图中我们假设硬盘只有 400 个柱面，共分区成为四个分区，第四个分区所在为第 301 到 400号柱面的范围。当你的操作系统为 Windows 时，那么第一到第四个分区的代号应该就是 C, D, E, F。当你有数据要写入F盘时，你的数据会被写入这块磁盘的301～400号柱面之间。

**为什么要分区?**
1. 数据的安全性
2. 系统的性能考虑

既然分区表只有记录四组数据的空间，那么是否代表我一块硬盘最多只能分区出四个分区？当然不是。有经验的朋友都知道，你可以将一块硬盘分区成十个以上的分区的。那又是如何达到的呢？在Windows/Linux系统中，我们是通过刚才谈到的扩展分区的方式来处理的。扩展分区的想法是：既然第一个扇区所在的分区表只能记录四条数据，那我可否利用额外的扇区来记录更多的分区信息？

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2uvrarlp8j30jg0augok.jpg)

上表设备文件名:
- P1:/dev/hda1
- P2:/dev/hda2
- L1:/dev/hda5
- L2:/dev/hda6
- L3:/dev/hda7
- L4:/dev/hda8
- L5:/dev/hda9

had3 与 had4 保留给 primary 或 extended

关于主分区,扩展分区与逻辑分区的特性L
- 主分区与扩展分区最多可以有四个(硬盘的限制)
- 扩展分区最多只能有一个(操作系统的限制)
- 逻辑分区是由扩展分区持续切割出来的分区

> flag：我的理解是当存在扩展分区就存在逻辑分区,逻辑分区只能依存在扩展分区,扩展分区如果删除,就删除所有逻辑分区

在Windows操作系统当中，如果你想要将D与E盘整合成为一个新的分区，而如果有两种分区的情况，如图3-5所示，图中的特殊颜色区块为D与E盘的示意，请问这两种方式是否均可将D盘与E盘整合成为一个新的分区？

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2uw9up47qj30fd0crwg1.jpg)

此图片上面可以进行整合,将两个分区删除。下图不可以整合,因为 D 与 E 分属主分区与逻辑分区,需要将扩展分区破坏掉然后重新分区。


> 如果我想将一块大硬盘“暂时”分成为4个分区，同时还有其他的剩余容量可以让我在未来的时候进行规划，我能不能分区出4个主分区？若不行，那么你建议该如何分区？

答：由于主分区和扩展分区最多只能有 4 个，其中扩展分区最多只能有一个，这个例题想要分区出4个分区且还要预留剩余容量，因此P+P+P+P的分区方式是不适合的。因为如果使用到4个主分区，则即使硬盘还有剩余容量，因为无法再继续分区，所以剩余容量就被浪费掉了。  假设你想要将所有的四条记录都花光，那么 P+P+P+E 是比较适合的。所以可以用的 4 个分区有3个主分区及一个逻辑分区，剩余的容量在扩展分区中。  如果你要分区超过 4 个以上时，一定要有扩展分区，而且必须将所有剩下的空间都分配给扩展分区，然后再以扩展分区来规划扩展分区的空间。另外，考虑到磁盘的连续性，一般建议将扩展分区的柱面号码分配在最后面的柱面内。

## 开机流程与主引导分区(MBR)
计算机中的 BIOS 与 CMOS 两个东西,CMOS 是记录各项硬件参数且嵌入在主板上面的存储器,BIOS 是一个写如到主板上的一个软件程序。它在开机的时候计算机系统会主动执行的第一个程序。

BIOS 会分析计算机里面有那些存储设备,我们以硬盘为例,BIOS 会依据用户的设置去取得能够开机的**硬盘**,并且到该硬盘读取第一个扇区的 MBR 位置。MBR 这个仅有 446 bytes 的硬盘容量里面会放置最基本的引导加载程序,此时 BIOS 就完成任务,MBR引导加载工作。

这个引导加载程序的目的是在**加载(load)内核**文件,由于引导加载程序是操作系统在安装的时候所提供的,所以它会识别硬盘内的文件系统格式,然后接下来就是内核文件的工作。

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2uwwspkskj308m0df0so.jpg)

1. BIOS:开机主动执行程序
2. MBR:开机设备第一个扇区内德主引导分区块,内含引导加载程序
3. 引导加载程序(Boot loader): 可读取内核文件来执行的软件
    - 提供菜单:用户可以选择不同的开机选项,这也是多重引导的重要功能。
    - 载入内核文件
    - 转交其他 loader
4. 内核文件: 开始操作系统的功能

**多重引导**功能<br>

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2v2974figj30i70bwgom.jpg)

MBR 的引导加载程序提供两个菜单,菜单一 (M1)可以直接加载 Windows 的内核文件来开机;菜单二(M2) 将引导加载工作交给第二个分区的启动扇区(boot 加载程序)当第二个引导加载程序启动后,该引导程序内仅有一个开机菜单。

- 每个分区都拥有自己的启动扇区(boot sector)
- 实际可开机的内核文件是放置到各分区内的
- loader 只会认识自己的系统分区内的可开机内核文件,以及其他 loader 而已。

> 问题:为什么要安装多重引导,最好先安装 Windows 再安装 Linux 呢?

答: Windows 在安装的时候,它的安装程序会主动覆盖掉 MBR 以及自己所在分区的启动扇区,你没有选择的机会,而且它没有让我们自己选择菜单的功能


## Linux 安装模式下,磁盘分区的选择(极重要)

### 目录树结构
整个 Linux 系统最重要的地方就是在于目录树结构，整个目录树结构最重要的就是那个根目录(root),表示方法为"/"

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2v2olohfdj30bm0670td.jpg)

我们的文件数据其实是放置在磁盘分区当中的,现在的问题是如何结合目录树的架构与磁盘内的数据,这牵扯到"挂载"的问题


### 文件系统盘与目录树的关系(挂载)
挂载:就是利用一个目录当成进入点,将磁盘分区的数据放置在该目录下;也就是说,进入该目录就可以读取该分区的意思.这个操作我们称为"挂载",那个进入点的目录我们称为"挂载点"

因此根目录是一定要挂载到某个分区,至于其他的目录则可自定义挂载到不同分区

![](http://ww1.sinaimg.cn/mw690/006rAlqhly1g2v2y6t54bj30b405edh5.jpg)

如上图我想判断某个文件在那个分区,通过反向追踪即可。上面 `home/vbird/test`,通过想上查找找到 home 这个进入点,从而判断


- 预留分区可以拿来作为备份来用。当你觉得某些脚本或者是重要的文件很值得备份时,就可以使用这个剩余的容量分出新的分区。

# 安装 Linux 前的规划

## 选择适合的版本
下载文件扩展名为 `.iso`,所谓的镜像文件，光盘刻录文件的

## 主机的服务规划与硬件的关系

- NAT (Linux 达到路由器的功能)
- SAMBA (加入Windows 网络上的邻居)
- Mail (邮件服务器)-Sendmail及 Postfix 两种邮件服务器软件
- Web (www 服务器)
- DHCP (提供客户端自动获取IP的功能)
- Proxy (代理服务器)
- FTP

## 主机硬盘的主要规划
- 懒人分区法-仅分出根目录与内存交换空间(/&swap)即可。然后预留剩余的磁盘以供后续的练习之用。

- 分析主机未来用途,分析需要大容量的目录,以及读写频繁的目录,将这些重要的目录分别独立出来而不与根目录放在一起,那当这些读写频繁的磁盘分区有问题时,至少不会影响到根目录的系统数据,比较符合容量大且(或)读写频繁的目录:

- /
- /usr
- /home
- /var
- swap

## 大硬盘配合旧主机造成的无法开机问题

旧的主板中, BIOS 可能找不到比较大容量的磁盘。所以可能造成无法开机.你只要将这个磁盘最前面的容量分出一个小分区,并将这个分区与系统启动文件的放置目录放在一起,就是 `/boot` 这个目录,重点是将启动扇区所在分区规范在小于1024 个柱面以内即可。在安装的时候,规划出三个三个扇区,分别是:

- /boot
- /
- swap
