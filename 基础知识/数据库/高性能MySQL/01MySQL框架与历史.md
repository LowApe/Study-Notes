# MySQL 架构与历史

MySQL的架构可以在多种不同场景中应用并发挥好的作用。MySQL 并不完美，单足够灵活，能够**适应高要求的环境**，例如Web 类应用。同时

- MySQL 既可以嵌入到应用程序中，也可以支持数据仓库、内容索引和部署软件
- 高可用的冗余系统
- 在线事务处理系统(OLTP)
- 通过配置使它在不同的硬件上都运行得很好
- 与众不同的存储引擎架构，将查询处理及其他系统任务和数据的存储/提取相分离

## MySQL 逻辑架构

如果能在头脑中构建出一副 MySQL 各组件之间的架构图

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g9sle22tz2j30nk0tejso.jpg)

| 层级   | 描述                                                         |
| ------ | ------------------------------------------------------------ |
| 最上层 | 大多数基于网络的客户端/服务器的工具<br />或者服务都有类似的架构<br />比如链接处理、授权认证、安全 |
| 第二层 | 查询解析、分析、优化、缓存以及所有的内置函数(例如，日期、时间、数学和加密函数)，所有跨存储引擎的功能都在这一层实现：存储过程、触发器、视图 |
| 第三层 | 包含了存储引擎。存储引擎负责 MySQL 中数据的存储和提取。存储引擎不会去解析 SQL，不同存储引擎之间也不会相互沟通，而是简单地响应上层服务器的请求 |



### 连接管理与安全性

每个客户端连接都会在服务器进程中**拥有一个线程**，轮流在某个 CPU 核心或者 CPU 中运行。服务器会负责缓存线程，因此不需要为每一个新建的连接创建或者销毁线程。当客户端连接到 MySQL 服务器时，服务器需要对其进行认证。认证基于用户名原始主机信息和密码。如果是使用了安全套接字(SSL)的方式连接，还可以使用 X.509 证书认证。一旦客户端连接成功，服务器会继续验证该客户端是否具有执行某个特定查询的权限

### 优化和执行

MySQL 会解析查询，并创建内部数据结构(解析树)，然后对其进行各种优化，包括重写查询、决定表的读取顺序，以及选择合适的索引。

优化器并不关心表使用的是什么存储引擎，但存储引擎对于优化査询是有影响的。优化器会请求存储引擎提供容量或某个具体操作的开销信息，以及表数据的统计信息等。例如，某些存储引擎的某种索引，可能对一些特定的査询有优化

对于 SELECT 语句，在解析査询之前，服务器会先**检査査询缓存**（Query Cache），如果能够在其中找到对应的查询，服务器就不必再执行査询解析、优化和执行的整个过程，而是直接**返回査询缓存中的结果集**。

## 并发控制

只要有多个查询需要在同一时刻修改数据，就会产生并发控制的问题。本章讨论**服务器层和存储引擎层**两个层面的并发控制