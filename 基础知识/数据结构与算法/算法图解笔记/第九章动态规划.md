# 动态规划

本章内容

- 学习动态规划，这是一种解决棘手问题的方法，它将问题分成小问题，并先着手解决这些小问题
- 学习如何设计问题的动态规划解决方案

## 背包问题

> 之前的实例：假设你是个小偷，背着一个可装`4`磅东西的背包，如何选择可以拿**价值最高的**东西

简单算法：尝试各种可能的商品组合，并找出价值最高的组合。这样可行，但是**速度非常慢**。在三件需要8种不同的集合；有4件商品，需要16个集合。这种算法的时间复杂度时O($2^n$),当适量多到一定程度，这种算法就行不通了。

## 动态规划

动态规划的原理：先解决子问题，再逐步解决大问题，通过**网格中单元格值**的公式

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1g7r1rwv6ewj30q00fcq4u.jpg)

列是将背包的容量4划分成1～4个类型的背包。然后行是将可装入种类也划分成1～3种。利用这种表格，可以将大问题分成小问题，根据解决的小问题，逐步解决大问题。



- 第一行最大价值为1500
- 第二行最大价值为3000
- 第三行最大价值为3500

$cell[i][j]=两者种较大的那个$ 

上一个单元格的值($cell[i-1][j]$) vs $当前商品的价值+剩余空间的价值$ 

## 背包问题FAQ

如果我们增加第四件商品可装入--iPhone(2000$ 1磅)

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7r2v4osmvj30na0k4mzq.jpg)

- 最后一行，第二列：拥有2空间，分别为可以装入iPhone+吉他，所以3500，剩余空间0
- 最后一行，第三列：拥有3空间，三背包的最大价值还是3500(iPhone+吉他)，剩余空间1
- 最后一行，第四列：拥有4空间，四背包最大价值是4000(笔记本电脑+iPhone)

### 行的排列顺序发生变化时结果将如何

没有变化，各行的排列顺序无关紧要

### 增加一件更小的商品如何

需要考虑粒度更细，因此必须调整网格

### 旅游行程最优化

实例：假设你要去度假，假期两天，你没办法去很多地方，因此你列出单子

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1g7r48etqjxj30v60fq0yd.jpg)

这也是一个背包问题！但约束条件不是背包的容量，二是有限的时间；不是决定该装入那些商品，而是决定该去游览那些名胜。根据清单绘制动态规划网格

![image.png](http://ww1.sinaimg.cn/large/006rAlqhgy1g7r4f44gubj30v60n0gz6.jpg)

### 处理相互依赖的情况

假设你还想去巴黎，因此在前述清单中又添加了几项

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7r4gtvou6j30ri080acx.jpg)

> 但仅当每个子问题都是离散的，即不依赖于其他子问题时，动态规划才管用

### 计算最终的解时会涉及两个以上的子背包吗？

为获得前述背包问题的最优解，可能需要偷两件以上的商品。但根据动态规划算法的设计，最多只需合并两个子背包，即根本不会涉及两个以上的子背包。不过这些子背包可能包含子背包



### 最优解可能导致背包没装满吗？

完全可能

## 最长公共子串

之前的动态规划问题，得到什么启示

- 动态规划可帮助你在给定约束条件下找到最优解。
- 在问题可分解为**彼此独立**且**离散**的子问题时，就可是一些通用的小贴士 
- 每种动态规划解决方案都涉及网格
- 单元格中的值通常就是你要优化的值
- 每个单元格都是一个子问题，因此你应考虑如何将问题分成子问题，这有助于你找出网格的**坐标轴**

实例：当你输入一个单词fish，但是不小心数错了一个或多个单词hish，机器是认为你是要输入fish还是vista？

### 绘制网格

用于解决这个的网格是怎么样的?

- 单元格中的值是什么？
- 如何将这个问题划分为子问题？
- 网格的坐标轴是什么？

这个例子中，你要找出两个单词的最长公共子串。hish和fish都包含的最长子串是什么呢？hish 和 vista呢？这就是你要计算的值

1. 单元格的值通常就是你要优化的值。在这个例子中，这很可能是一个数字：两个字符串都包含的**最长子串的长度**

2. 如何将这个问题划分为子问题呢？你可能需要比较子串：hish和fish的子串是his和fis
3. 这也给你提供了线索，让你觉得坐标轴很可能是这两个单词

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7s51k8gs7j30q00kywk4.jpg)

### 填充网格

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7sdv2fixdj30v00pqdq3.jpg)

根据之前的经验，我们将单词拆分到最小单元，一个单词，然后单词格的值为匹配的最长子串的值。

- 如果两个字母不相同，值为0
- 如果两个字母相同，值为左上角邻居的值加1

> ⚠️提示：为什么要左上角邻居加1，是因为左上角的值为当前格的子串匹配数。比较的是子串匹配，所以比较的结果都在对角线上

```python
if word_a[i] == word_b[j]
	cell[i][j] = cell[i-1][j-1]+1
else:
	cell[i][j] = 0
```

如果vista 与 hish 比较的出最大字串

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7s6o7tapcj30og0oownt.jpg)

> ⚠️注意：这个问题最终答案并不在最后一个单元格。对于背包问题，最终答案总是在最后的单元格中。但对于**最长公共子串**问题，答案为网格中最大的数字

其中那个单词与 hish 更像？fish和hish 的最长公共子串包含三个字母，而hish 与 vista 最长公共子串包含两个字母

### 最长公共子序列

> - 最长公共子串：连续，最大子串匹配的长度
> - 最长公共子序列：不连续，相匹配的个数

如果不小心输入 fosh，他原本想输入的是 fish 还是 fort呢？

我们使用**最长公共子串公式**比较它们

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7s6wvzxhjj30vi0cyjz1.jpg)

这里比较的是最长公共**子串**，最长子串长度都是2，但fosh与fish更像。其实这里应比较最长公共**子序列**：两个单词中都有的序列包含的**字母数**

### 最长公共子序列之解决方案

![image.png](http://ww1.sinaimg.cn/large/006rAlqhly1g7sefhow1wj30vk0fugv9.jpg)

- 如果两个字母不同，就选择上方和左方邻居中较大的那个
- 如果两个字母相同，就将当前单元格的值设置为左上方单元格的值加1

```python
if word_a[i] == word_b[j]:
	cell[i][j] = cell[i-1][j-1]+1
else:
	cell[i][j] = max(cell[i-1][j]),cell[i][j-1]
```

> 其实这个公式不知道怎么来的，公式是对的，如果用归纳应该可以得出来，不过我用人脑是直接一个个算得

动态规划的实际应用：

- 生物学家根据最长公共序列来确定DNA链的相似性，进而判断两种动物或疾病有多相似。最长公共序列还被用来寻找多发性硬化症治疗方案
- 你使用过诸如`git diff` 的命令？它们指出两个文件的差异，也是使用动态规划实现的
- 编辑距离指出了两个**字符串的相似程度**，也就是动态规划计算得到的。编辑距离算法的用途很多，从拼写检查到判断用户上传的资料是否是盗版，都在其中
- wps具有断字功能的应用程序，它们如何确定在什么地方断字以确保行长一致呢？使用动态规划

# 小结

- 需要在给定约束条件下优化某种指标时，动态规划很有用
- 问题可分散为离散子问题时，可使用动态规划来解决
- 每种动态规划解决方案都涉及网格
- 单元格中的值通常就是你要优化的值
- 每个单元格都是一个子问题，因此你要考虑如何将问题分解为子问题